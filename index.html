<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Focus Task Tracker v2.0</title>

<style>
:root{
  --bg:#000;
  --card:#0b0b0b;
  --border:#222;
  --text-dim:#9ca3af;
}
*{box-sizing:border-box}
html,body{width:100%;height:100%}
body{
  margin:0;
  font-family:Inter,Arial,sans-serif;
  background:
    radial-gradient(circle at 1px 1px,#111 1px,transparent 0) 0 0/24px 24px,
    var(--bg);
  color:#fff;
  display:flex;
}

/* SOUND TOGGLE */
.sound-toggle{
  position:fixed;
  top:14px;
  right:16px;
  background:#000;
  border:1px solid #333;
  border-radius:12px;
  padding:8px 10px;
  cursor:pointer;
  font-size:18px;
}

/* MESSAGE */
.message{
  position:fixed;
  top:60px;
  right:16px;
  background:#111;
  border:1px solid #444;
  padding:12px 16px;
  border-radius:12px;
  opacity:0;
  transform:translateY(-10px);
  transition:.3s;
}
.message.show{opacity:1;transform:translateY(0)}

.left{flex:1;display:flex;justify-content:center;align-items:center}
.right{
  width:360px;
  background:#020202;
  border-left:2px solid var(--border);
  padding:24px;
  overflow-y:auto;
}

/* CARD */
.card{
  width:420px;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  padding:32px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:22px;
}

/* STATS */
.stats{display:flex;gap:20px}
.stat{
  width:140px;height:140px;
  background:#000;
  border:1px solid #444;
  border-radius:18px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
}
.stat-value{font-size:42px;font-weight:800}
.stat-label{font-size:13px;color:var(--text-dim)}

/* TIMER */
.timer-wrap{width:120px;height:120px}
.timer-ring{
  width:100%;height:100%;
  border-radius:50%;
  background:conic-gradient(#111 360deg,#111 0);
  border:1px solid #555;
  display:flex;
  justify-content:center;
  align-items:center;
}
.timer-inner{
  width:86px;height:86px;
  border-radius:50%;
  border:1px solid #444;
  display:flex;
  justify-content:center;
  align-items:center;
  font-size:26px;
  font-weight:700;
}

/* INPUTS */
input{
  width:100%;
  padding:12px;
  background:#000;
  border:1px solid var(--border);
  border-radius:10px;
  color:#fff;
  text-align:center;
}

/* BUTTONS */
button{
  padding:14px 22px;
  border-radius:14px;
  border:none;
  font-weight:600;
  color:#fff;
  cursor:pointer;
}
.start{background:#16a34a}
.pause{background:#ca8a04}
.stop{background:#dc2626}
.submit{background:#2563eb}
.undo{background:#4b5563}
.backup{background:#0ea5e9}

.button-row{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  justify-content:center;
}

/* LOG */
.task-group{padding:12px 0;border-bottom:1px solid #333}
.task-title{font-weight:600}
.task-count{font-size:13px;color:var(--text-dim)}

.backup-section{
  margin-top:24px;
  padding-top:16px;
  border-top:1px solid #333;
}
</style>
</head>

<body>

<div class="sound-toggle" id="soundBtn" onclick="toggleSound()">üîî</div>
<div class="message" id="msg">‚è∞ Time‚Äôs up! Task auto-submitted</div>

<div class="left">
  <div class="card">

    <div class="stats">
      <div class="stat">
        <div class="stat-value" id="count">0</div>
        <div class="stat-label">Total Tasks</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="totalTime">00:00</div>
        <div class="stat-label">Total Time</div>
      </div>
    </div>

    <div class="timer-wrap">
      <div class="timer-ring" id="ring">
        <div class="timer-inner" id="timer">00:00</div>
      </div>
    </div>

    <input id="taskName" placeholder="Task name">
    <input id="timeInput" type="number" placeholder="Time in minutes">

    <div class="button-row">
      <button class="start" onclick="startTimer()">Start</button>
      <button class="pause" onclick="pauseTimer()">Pause</button>
      <button class="stop" onclick="stopTimer()">Stop</button>
    </div>

    <div class="button-row">
      <button class="submit" onclick="submitTask()">+1 Submit</button>
      <button class="backup" onclick="submitTime()">‚è± Submit Time</button>
      <button class="undo" onclick="undoTask()">‚àí1 Undo</button>
    </div>

    <input id="manualTime" type="number" placeholder="Add past time (minutes)">
    <div class="button-row">
      <button class="backup" onclick="addManualTime()">‚ûï Add Time</button>
    </div>

  </div>
</div>

<div class="right">
  <h3>Task Log</h3>
  <div id="taskLog"></div>

  <div class="backup-section">
    <button class="backup" onclick="downloadLog()">Download Backup</button>
    <input type="file" accept=".txt" onchange="loadLog(event)">
  </div>
</div>

<audio id="alarm" src="iphone_alarm.mp3" loop preload="auto"></audio>

<script>
/* ===== STATE ===== */
let totalCount=0, totalTimeSpent=0;
let startTime=null, endTime=null, durationSec=0;
let tickInterval=null;
let soundOn=true;
const alarm=document.getElementById("alarm");
const tasks={};

/* ===== SOUND ===== */
function toggleSound(){
  soundOn=!soundOn;
  soundBtn.innerText=soundOn?"üîî":"üîï";
  stopAlarm();
}
function unlockAudio(){
  alarm.muted=true;
  alarm.play().then(()=>{
    alarm.pause();
    alarm.currentTime=0;
    alarm.muted=false;
  }).catch(()=>{});
}
function startAlarm(){ if(soundOn){ alarm.currentTime=0; alarm.play(); } }
function stopAlarm(){ alarm.pause(); alarm.currentTime=0; }

/* ===== NOTIFICATION ===== */
function requestNotificationPermission(){
  if("Notification" in window && Notification.permission==="default"){
    Notification.requestPermission();
  }
}
function showDesktopNotification(task){
  if("Notification" in window && Notification.permission==="granted"){
    new Notification("‚è∞ Timer Completed",{ body:`Task "${task}" auto-submitted`, silent:true });
  }
}

/* ===== UI ===== */
function formatTime(sec){
  const m=Math.floor(sec/60), s=sec%60;
  return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}
function updateRing(rem){
  const deg=(1-rem/durationSec)*360;
  ring.style.background=`conic-gradient(#2563eb ${deg}deg,#111 ${deg}deg)`;
}
function showMessage(){
  msg.classList.add("show");
  setTimeout(()=>msg.classList.remove("show"),3000);
}

/* ===== TIMER ===== */
function startTimer(){
  unlockAudio();
  requestNotificationPermission();
  if(tickInterval) return;

  const mins=Number(timeInput.value);
  if(!mins||mins<=0) return;

  durationSec=mins*60;
  startTime=Date.now();
  endTime=startTime+durationSec*1000;

  tick();
  tickInterval=setInterval(tick,1000);
}

function tick(){
  const remMs=endTime-Date.now();
  if(remMs<=0){
    clearInterval(tickInterval);
    tickInterval=null;
    timer.innerText="00:00";
    updateRing(0);
    startAlarm();
    autoSubmit();
    return;
  }
  const remSec=Math.ceil(remMs/1000);
  timer.innerText=formatTime(remSec);
  updateRing(remSec);
}

function pauseTimer(){
  clearInterval(tickInterval);
  tickInterval=null;
}
function stopTimer(){
  clearInterval(tickInterval);
  tickInterval=null;
  timer.innerText="00:00";
  ring.style.background="conic-gradient(#111 360deg,#111 0)";
}

/* ===== TASKS ===== */
function ensureTask(t){
  if(tasks[t]) return;
  const g=document.createElement("div");
  g.className="task-group";
  g.innerHTML=`<div class="task-title">${t}</div><div class="task-count">Total done: 0</div>`;
  taskLog.prepend(g);
  tasks[t]={count:0,countEl:g.children[1]};
}

function autoSubmit(){
  const t=taskName.value||"Unnamed Task";
  submitTask(true);
  showMessage();
  showDesktopNotification(t);
  stopAlarm();
}

function submitTask(auto=false){
  const t=taskName.value||"Unnamed Task";
  ensureTask(t);

  totalCount++;
  tasks[t].count++;
  tasks[t].countEl.innerText=`Total done: ${tasks[t].count}`;
  count.innerText=totalCount;

  const spent=Math.round((Date.now()-startTime)/1000);
  totalTimeSpent+=spent;
  totalTime.innerText=formatTime(totalTimeSpent);

  if(!auto) stopTimer();
}

function submitTime(){
  if(!startTime) return;
  const spent=Math.round((Date.now()-startTime)/1000);
  totalTimeSpent+=spent;
  totalTime.innerText=formatTime(totalTimeSpent);
  stopTimer();
  startTime=null;
}

function addManualTime(){
  const mins=Number(manualTime.value);
  if(!mins||mins<=0) return;
  totalTimeSpent+=mins*60;
  totalTime.innerText=formatTime(totalTimeSpent);
  manualTime.value="";
}

function undoTask(){
  const t=taskName.value||"Unnamed Task";
  if(!tasks[t]||tasks[t].count===0) return;
  totalCount--;
  tasks[t].count--;
  tasks[t].countEl.innerText=`Total done: ${tasks[t].count}`;
  count.innerText=totalCount;
}

/* ===== BACKUP ===== */
function downloadLog(){
  let txt=`TOTAL_TASKS:${totalCount}\nTOTAL_TIME:${totalTimeSpent}\n`;
  Object.keys(tasks).forEach(t=>txt+=`${t}:${tasks[t].count}\n`);
  const b=new Blob([txt],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="task_log_backup.txt";
  a.click();
}
function loadLog(e){
  const f=e.target.files[0]; if(!f) return;
  const r=new FileReader();
  r.onload=()=>{
    taskLog.innerHTML="";
    Object.keys(tasks).forEach(k=>delete tasks[k]);
    totalCount=0; totalTimeSpent=0;
    r.result.split("\n").forEach(l=>{
      if(!l.trim()) return;
      if(l.startsWith("TOTAL_TASKS")){
        totalCount=Number(l.split(":")[1]);
        count.innerText=totalCount;
      }else if(l.startsWith("TOTAL_TIME")){
        totalTimeSpent=Number(l.split(":")[1]);
        totalTime.innerText=formatTime(totalTimeSpent);
      }else{
        const [t,c]=l.split(":");
        ensureTask(t);
        tasks[t].count=Number(c);
        tasks[t].countEl.innerText=`Total done: ${c}`;
      }
    });
  };
  r.readAsText(f);
}
</script>

</body>
</html>
